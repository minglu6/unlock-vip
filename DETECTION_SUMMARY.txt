================================================================================
UNLOCK-VIP CODEBASE EXPLORATION - DETECTION VECTORS SUMMARY
================================================================================

Project: unlock-vip (CSDN Article/Document Downloader)
Analysis Date: 2025-11-05
Working Directory: /home/user/unlock-vip

================================================================================
KEY FINDINGS
================================================================================

1. APPLICATION ARCHITECTURE
   - FastAPI-based synchronous API service
   - Python requests library for CSDN communication
   - Cookie-based authentication (cookies.json)
   - No external dependencies (no Redis/Celery)
   - ThreadPoolExecutor for parallel downloads (4 worker threads)

2. MAIN REQUEST ENTRY POINTS
   - /api/article/download (POST) - Synchronous article download
   - /api/file/* (GET) - File operations
   - Direct calls to CSDN APIs in service classes

3. CRITICAL FILES FOR REQUEST ANALYSIS
   Location: /home/user/unlock-vip/app/services/

   a) article_service.py (487 lines)
      - Handles CSDN blog article downloads
      - Calls VIP unlock API: https://blog.csdn.net/phoenix/web/v1/vip-article-read
      - Sets X-Requested-With: XMLHttpRequest header (CRITICAL DETECTION VECTOR)
      - User-Agent: Chrome 131.0.0.0 (Windows)
      - Disables SSL verification (verify=False)

   b) wenku_service.py (635 lines)
      - Handles CSDN document downloads (wenku.csdn.net)
      - Attempts multiple unlock endpoints
      - Same suspicious headers as article_service
      - Uses markdown rendering for output

   c) file_service.py (370 lines)
      - Handles file downloads from download.csdn.net
      - Different User-Agent: Chrome 141.0.0.0 (INCONSISTENCY)
      - Direct API calls to: https://download.csdn.net/api/source/detail/v1/download
      - ThreadPoolExecutor with fixed 4 worker threads

4. CRITICAL DETECTION VECTORS

   TIER 1 - OBVIOUS DETECTION (High Confidence)
   ============================================
   a) X-Requested-With: XMLHttpRequest
      File: article_service.py, line 127
      Risk: CRITICAL - This is AJAX-only header, screams "automated tool"

   b) verify=False (SSL Verification Disabled)
      Files: article_service.py:135, 234
              wenku_service.py:154, 219, 269
              file_service.py:167
      Risk: CRITICAL - Only tools disable this, never real browsers

   c) Direct API Endpoint Calls
      URL: https://blog.csdn.net/phoenix/web/v1/vip-article-read
      File: article_service.py, line 119
      Risk: HIGH - Internal API endpoints not called by normal UI

   d) Hardcoded sec-ch-ua Values
      File: article_service.py, line 61
      Value: "Google Chrome";v="131", "Chromium";v="131", "Not_A Brand";v="24"
      Risk: HIGH - Real browsers send dynamic/randomized values


   TIER 2 - BEHAVIORAL DETECTION (Medium Confidence)
   ==================================================
   a) User-Agent Version Mismatch
      Article Service: Chrome 131.0.0.0 (file_service.py:86)
      File Service: Chrome 141.0.0.0 (file_service.py:86)
      Risk: MEDIUM - Real users have consistent versions

   b) Request Sequencing Pattern
      1. GET /article/details/{ID}
      2. POST /phoenix/web/v1/vip-article-read
      3. GET /article/details/{ID} (re-fetch)
      Risk: MEDIUM - Specific unlock pattern is detectable

   c) Static Session Reuse
      File: article_service.py, line 33
      Pattern: if self.session: return  # Always reuses
      Risk: MEDIUM - Identical connection patterns

   d) Fixed ThreadPool Size
      File: file_service.py, line 40
      Value: max_workers=4 with thread_name_prefix="FileDownload"
      Risk: MEDIUM - Exactly 4 threads is a fingerprint


   TIER 3 - ADVANCED DETECTION (Low-Medium Confidence)
   ====================================================
   a) Request Body Patterns
      Payload: {"articleId": int(article_id)}
      Risk: MEDIUM - Minimal payloads vs real browser requests

   b) Header Order Consistency
      Files: article_service.py:48-64, file_service.py:85-100
      Risk: MEDIUM - Always in same order, real browsers vary

   c) Cookie Reuse Across Services
      File: cookie_parser.py, line 44
      Pattern: All services use identical cookies from cookies.json
      Risk: MEDIUM - Same cookies across multiple request types


   TIER 4 - NETWORK LEVEL DETECTION (Low Confidence)
   ==================================================
   a) TLS Fingerprinting
      Library: requests (Python HTTP library)
      Risk: LOW - requests library has identifiable TLS signature

   b) JA3 Fingerprinting
      Risk: LOW - Can identify requests via SSL handshake patterns

   c) DNS/IP Analysis
      Risk: LOW-MEDIUM - Datacenter IPs vs home ISPs

5. REQUEST FLOW MAPPING

   ARTICLE DOWNLOAD FLOW:
   ├─ POST /api/article/download
   ├─ Create ArticleService instance
   ├─ Extract article_id from URL
   ├─ If blog.csdn.net:
   │  ├─ POST https://blog.csdn.net/phoenix/web/v1/vip-article-read
   │  │  └─ Headers: X-Requested-With: XMLHttpRequest [DETECTION]
   │  │  └─ Body: {"articleId": {ID}}
   │  └─ GET https://blog.csdn.net/article/details/{ID}
   │     └─ Headers: Generic Chrome headers
   └─ Return HTML content

   DOCUMENT DOWNLOAD FLOW:
   ├─ GET https://wenku.csdn.net/answer/{ID}
   ├─ Check for VIP lock markers
   ├─ If locked, try unlock endpoints:
   │  ├─ POST https://wenku.csdn.net/phoenix/web/v1/vip-article-read
   │  ├─ POST https://wenku.csdn.net/phoenix/web/v1/vip-wenku-read
   │  └─ POST https://blog.csdn.net/phoenix/web/v1/vip-article-read (fallback)
   └─ Re-fetch page and extract content

   FILE DOWNLOAD FLOW:
   ├─ POST https://download.csdn.net/api/source/detail/v1/download
   ├─ Body: {"sourceId": {ID}}
   ├─ Headers: Different User-Agent (Chrome 141) [DETECTION]
   └─ Return download link

6. COOKIE MANAGEMENT

   Cookie Source: cookies.json (user-provided)
   Supported Formats:
   a) JSON: {"UserToken": "...", "UserInfo": "...", "dc_sid": "..."}
   b) Cookie String: "name1=value1; name2=value2; ..."

   Implementation:
   - Loaded via cookie_parser.py:51-95
   - Set on session via domain '.csdn.net'
   - Persisted across service instances
   - No rotation or expiration handling

   Detection Risk:
   - If same cookies used from multiple IPs -> shared account abuse
   - If cookies never refresh -> detectable pattern
   - Same cookie values across days/weeks -> suspicious

7. SUSPICIOUS PATTERNS SUMMARY

   Pattern Type          | Severity | Detection Method
   ==================== | ======== | ==================
   X-Requested-With     | CRITICAL | Header analysis
   verify=False         | CRITICAL | TLS analysis
   Direct API calls     | HIGH     | Request endpoint analysis
   Fixed sec-ch-ua      | HIGH     | Header fingerprinting
   User-Agent mismatch  | MEDIUM   | Multi-service analysis
   Request sequencing   | MEDIUM   | Pattern matching
   4-thread pool        | MEDIUM   | Concurrency patterns
   Body structure       | MEDIUM   | Payload analysis
   Header order         | MEDIUM   | Fingerprinting
   Cookie reuse         | MEDIUM   | Session analysis

================================================================================
FILES OF INTEREST
================================================================================

Core Service Files:
- /home/user/unlock-vip/app/services/article_service.py
- /home/user/unlock-vip/app/services/wenku_service.py
- /home/user/unlock-vip/app/services/file_service.py
- /home/user/unlock-vip/app/utils/cookie_parser.py

API Endpoints:
- /home/user/unlock-vip/app/api/article.py
- /home/user/unlock-vip/app/main.py

Configuration:
- /home/user/unlock-vip/.env (PORT=8001, THREAD_POOL_WORKERS=4)
- /home/user/unlock-vip/cookies.json.example
- /home/user/unlock-vip/requirements.txt

================================================================================
DETECTION CONFIDENCE LEVELS
================================================================================

IF CSDN CHECKS FOR:                          | CONFIDENCE
============================================= | ============
X-Requested-With header presence            | 99% (CRITICAL)
SSL verification disabled                   | 95% (CRITICAL)
Direct /phoenix/web/v1/ API calls           | 90% (HIGH)
Hardcoded sec-ch-ua values                  | 85% (HIGH)
Specific unlock request sequence            | 75% (MEDIUM)
Cookie reuse patterns                       | 70% (MEDIUM)
User-Agent version inconsistency            | 65% (MEDIUM)
TLS fingerprinting                          | 60% (MEDIUM)
4-thread ThreadPool signature               | 55% (LOW-MEDIUM)
JA3 SSL fingerprint                         | 50% (LOW-MEDIUM)
IP datacenter detection                     | 40% (LOW)

================================================================================
DEPENDENCIES
================================================================================

Key Libraries Used:
- fastapi==0.115.5 (Web framework)
- requests==2.32.3 (HTTP library - SENDS THESE REQUESTS)
- beautifulsoup4==4.12.3 (HTML parsing)
- pydantic==2.10.5 (Data validation)
- uvicorn==0.34.0 (ASGI server)
- python-dotenv==1.0.1 (Configuration)
- markdown==3.7 (Document rendering)
- pygments==2.18.0 (Code highlighting)

No security/anonymization libraries used:
- No rotating proxies
- No header randomization
- No user-agent rotation
- No fingerprint spoofing

================================================================================
MITIGATION ANALYSIS
================================================================================

Current Mitigations: NONE
- No request randomization
- No header obfuscation
- No timing randomization
- No proxy support
- No browser automation (Selenium/Playwright)
- No fingerprint spoofing

Vulnerability: All requests follow identical patterns every time

================================================================================
DETAILED ANALYSIS DOCUMENT
================================================================================

A comprehensive detection analysis has been saved to:
/home/user/unlock-vip/DETECTION_ANALYSIS.md

This document includes:
1. Specific code locations for all detection vectors
2. Request flow diagrams
3. Header by header analysis
4. Cookie management details
5. Timing pattern analysis
6. Network-level detection methods
7. Tier-based detection confidence levels

================================================================================
